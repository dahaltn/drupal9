# This is a basic workflow that is manually triggered

name: digital_ocean_deployment
on:
  push:
    branches: [main]
  
jobs:
  Build:
    runs-on: self-hosted
    
    steps:
      - uses: actions/checkout@main
      - name: Create .env
        run: |
          touch .env
          echo DB_USER=${{secrets.DB_USER}} >> .env
          echo DB_PASS=${{secrets.DB_PASS}} >> .env
          echo DB_DIR=${{secrets.DB_DIR}} >> .env
          echo DB_DATABASE=${{secrets.DB_DATABASE}} >> .env
          echo DB_HOST=${{secrets.DB_HOST}} >> .env
          echo SITE_URL=${{secrets.SITE_URL}} >> .env
          echo ADMINER_URL=${{secrets.ADMINER_URL}} >> .env
          echo TRAEFIK_URL=${{secrets.TRAEFIK_URL}} >> .env

      - name: change Permission
        run: |
          cp src/sites/default/settings.php drupal/web/sites/default
          chmod 600 traefik-data/acme.json
        
      - name: Building Docker
        run: |
          alias dc=docker-compose
          docker-compose down
          docker-compose up -d

      - name: Instelling Drupal
        run: |
          docker-compose exec web composer install
          docker-compose exec web composer id -Y